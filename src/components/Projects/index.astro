---
import { Image } from "astro:assets";

import Mantenimiento from "./images/mantenimientoo.jpg";
import GestiHorarios from "./images/GestiHorarios.png";
import CryptoSalud from "./images/CryptoSalud.png";
import JBLPopayan from "./images/jbl-popayan.png";
import JakeTienda from "./images/jake-tienda.png";

import { Icon } from "astro-icon";

const PROJECTS = [
  {
    name: "JBL Popayán",
    image: { src: JBLPopayan, alt: "JBL Popayán - Tienda de Audio" },
    description:
      "E-commerce de productos de audio JBL con sistema de carrito de compras y gestión de productos",
    technologies: ["Tailwind CSS", "TypeScript", "Next.js", "Shopify"],
    liveLink: "https://www.jblpopayan.com/",
    sourceLink: "https://github.com/igrisdev/jbl-by-harman-tienda-frontend",
  },
  {
    name: "Jake Tienda Electrónica",
    image: { src: JakeTienda, alt: "Jake Tienda Electrónica" },
    description:
      "Compra los mejores productos de DJ en Jake - Tienda online con catálogo de marcas reconocidas",
    technologies: ["Tailwind CSS", "TypeScript", "Next.js", "Shopify"],
    liveLink: "https://www.jaketiendaelectronica.com/",
    sourceLink: "https://github.com/igrisdev/jake-tienda-frontend",
  },
  {
    name: "CryptoSalud",
    image: { src: CryptoSalud, alt: "CryptoSalud" },
    description:
      "Página web de historias clínicas implementando blockchain y docker para seguridad de datos",
    technologies: ["Vue.js", "Express", "Node.js", "MongoDB", "Docker"],
    sourceLink: "https://github.com/Filollan/Backend_Historias_Clinicas",
  },
  {
    name: "GestiHorarios",
    image: { src: GestiHorarios, alt: "GestiHorarios" },
    description:
      "Aplicación web para hacer la gestión de horarios de docentes de una institución educativa",
    technologies: ["Laravel", "Bootstrap", "MySQL", "Apache"],
    sourceLink: "https://github.com/Filollan/GestiHorarios",
  },
];
---

<div class="section__divider">
  <section class="container section projects-section" id="projects">
    <!-- Contenedor de partículas -->
    <div class="particles-container" aria-hidden="true">
      <canvas
        class="particles-canvas"
        data-particle-animation
        width="100%"
        height="100%"
        style="width: 100%; height: 100%;"
      >
      </canvas>
    </div>
    <h2 class="section__title">Proyectos</h2>
    <p class="section__description">...</p>
    <div class="project-list">
      {
        PROJECTS.map((project) => (
          <div class="project__wrapper" data-inviewport>
            <article class="project">
              <div class="project__image">
                <Image
                  src={project.image.src}
                  width={800}
                  height={538}
                  alt={project.image.alt}
                />
              </div>

              <div>
                <h3 class="medium-heading">{project.name}</h3>
                <p class="small-p">{project.description}</p>
                <ul class="project__technologies list">
                  {project.technologies.map((technology) => (
                    <li>{technology}</li>
                  ))}
                </ul>
                {
                  <div class="project__links">
                    {project.liveLink && (
                      <a
                        class="button button--primary"
                        target="_blank"
                        href={project.liveLink}
                      >
                        <span class="icon-wrapper--small">
                          <Icon name="lucide:link" class="icon-xs" />
                        </span>
                        <span>Página</span>
                      </a>
                    )}
                    <a
                      class="button button--secondary button--outline"
                      target="_blank"
                      href={project.sourceLink}
                    >
                      <span class="icon-wrapper--small">
                        <Icon name="lucide:github" class="icon-xs" />
                      </span>
                      <span>Código</span>
                    </a>
                  </div>
                }
              </div>
            </article>
          </div>
        ))
      }
    </div>
  </section>
</div>

<style lang="scss">
  @use "styles/screen";
  .projects-section {
    position: relative;
    z-index: 1;
  }

  .particles-container {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: -1;
  }

  .particles-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .project-list {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;

    @media (min-width: screen.$md) {
      grid-template-columns: repeat(2, 1fr);
      gap: 2.5rem;
    }
  }

  .project {
    display: flex;
    flex-direction: column;
    height: 100%;
    transition: var(--transition-smooth);

    &__wrapper {
      background-color: var(--background);
      border: 1px solid var(--accents-2);
      border-radius: var(--border-radius-xl);
      box-shadow: var(--shadow-md);
      transition: var(--transition-smooth);
      overflow: hidden;
      height: 100%;
      display: flex;
      flex-direction: column;

      &:hover {
        transform: translateY(-10px);
        box-shadow: var(--shadow-xl);
        border-color: var(--accents-3);
      }
    }

    &__image {
      width: 100%;
      height: 240px;
      overflow: hidden;
      background-color: var(--accents-1);
      flex-shrink: 0;

      @media (min-width: screen.$md) {
        height: 280px;
      }

      img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
        transition: var(--transition-smooth);
      }
    }

    &__wrapper:hover &__image img {
      transform: scale(1.08);
    }

    /* Contenedor de texto/contenido */
    > div:not(.project__image) {
      display: flex;
      flex-direction: column;
      flex: 1;
      padding: 1.5rem;
    }

    &__technologies {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1.5rem;

      li {
        padding: 0.25rem 0.75rem;
        font-size: 15px;
        color: var(--accents-8);
        background: var(--gray-alpha-400);
        border: 1px solid var(--accents-2);
        border-radius: var(--border-radius-sm);
        box-shadow: var(--badge-shadow);
        transition: var(--transition-smooth);

        &:hover {
          background: var(--accents-2);
          transform: translateY(-2px);
          box-shadow: var(--shadow-sm);
        }
      }
    }

    &__links {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
      margin-top: auto; /* Empuja los enlaces al fondo si hay espacio */

      a {
        text-decoration: none;
      }
    }

    @media (min-width: screen.$md) {
      &__title {
        font-size: 1.75rem;
      }

      &__description {
        font-size: 1.1rem;
      }
    }
    /* Eliminado el media query que cambiaba a flex-direction: row */
  }
</style>

<script>
  import { ParticleAnimation } from "../../utils/particles";

  document.addEventListener("DOMContentLoaded", () => {
    const canvas = document.querySelector(
      "#projects [data-particle-animation]",
    );
    if (!(canvas instanceof HTMLCanvasElement)) return;

    // Configuración específica para la sección de proyectos
    const projectsParticles = new ParticleAnimation(canvas, {
      quantity: 25, // Más partículas para crear un efecto más dinámico
      staticity: 2.5, // Movimiento moderado
      ease: 25, // Velocidad moderada
      particleColor: {
        light: "rgba(255, 0, 0, 0.6)", // Rojo suave en modo claro
        dark: "rgba(255, 255, 255, 0.6)", // Blanco suave en modo oscuro
      },
    });

    // Limpieza cuando el componente se desmonta
    document.addEventListener("astro:before-swap", () => {
      projectsParticles.destroy();
    });
  });
</script>
