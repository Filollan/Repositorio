---
import { Image } from "astro:assets";
import diplomaVue from "./images/diploma-vue.jpg";
/* import diplomaPhp from './images/diploma-phpp.jpg';
import diplomaLaravel from './images/diploma-laravel.jpg';
import diplomaReact from './images/diploma-react.jpg';
import diplomaNode from './images/diploma-node.jpg'; */
import diplomaJs from "./images/diploma-JavaScript.jpg";
/* import diplomaB1 from './images/Certificado-B1.jpg'; */
import diplomaIA from "./images/diploma-ia.jpg";
import diplomaWeb from "./images/Certificado-programacion.png";

const CERTIFICATES = [
  {
    title: "Certificado en HTML, CSS y Javascript",
    image: { src: diplomaWeb, alt: "Certificado en HTML, CSS y Javascript" },
  },
  /* {
    title: "Certificado B1",
    image: { src: diplomaB1, alt: 'Certificado de B1' },
  },
  {
    title: "Certificado en PHP",
    image: { src: diplomaPhp, alt: 'Certificado en PHP' },
  },
  {
    title: "Certificado en Laravel",
    image: { src: diplomaLaravel, alt: 'Certificado en Laravel' },
  }, */
  {
    title: "Certificado en Javascript",
    image: { src: diplomaJs, alt: "Certificado en Javascript" },
  },
  {
    title: "Certificado en Vue.js",
    image: { src: diplomaVue, alt: "Certificado en Vue.js" },
  },
  {
    title: "Certificado en Inteligencia Artificial",
    image: { src: diplomaIA, alt: "Certificado en fundamentos en IA" },
  },
  /* {
    title: "Certificado en React y redux",
    image: { src: diplomaReact, alt: 'Certificado en React y redux' },
  },
  {
    title: "Certificado en Node.js",
    image: { src: diplomaNode, alt: 'Certificado en Node.js' },
  }, */
];
---

<section class="certificates section" id="certificates">
  <div class="particles-container" aria-hidden="true">
    <canvas
      class="particles-canvas"
      data-particle-animation
      width="100%"
      height="100%"
      style="width: 100%; height: 100%;"
    >
    </canvas>
  </div>

  <h2 class="section__title">Certificados</h2>

  <div class="certificates__list">
    {
      CERTIFICATES.map((certificate, index) => (
        <div class="certificates__item" data-inviewport>
          <button
            class="certificates__image-wrapper"
            data-certificate-index={index}
            aria-label={`Ver ${certificate.title} en grande`}
          >
            <Image
              class="certificates__image"
              src={certificate.image.src}
              alt={certificate.image.alt}
              width={300}
              height={200}
            />
            <div class="certificates__overlay">
              <span class="certificates__zoom-icon">üîç</span>
            </div>
          </button>
          <h3 class="certificates__title">{certificate.title}</h3>
        </div>
      ))
    }
  </div>

  <!-- Modal Lightbox -->
  <div class="lightbox" id="certificate-lightbox" aria-hidden="true">
    <button class="lightbox__close" aria-label="Cerrar">&times;</button>
    <div class="lightbox__content">
      <img class="lightbox__image" src="" alt="" />
    </div>
  </div>
</section>

<style lang="scss">
  .certificates {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 2rem 1rem;
    gap: 2rem;
    overflow: hidden;
    min-height: 100vh;

    .particles-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      pointer-events: none;
    }

    &__list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      width: 100%;
      max-width: 1200px;
    }

    &__item {
      background-color: var(--background);
      border: 1px solid var(--accents-2);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-md);
      text-align: center;
      padding: 1rem;
      transition: var(--transition-smooth);
      overflow: hidden;

      &:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: var(--shadow-xl);
        border-color: var(--accents-3);
      }
    }

    &__image-wrapper {
      position: relative;
      display: block;
      width: 100%;
      cursor: pointer;
      background: none;
      border: none;
      padding: 0;
      overflow: hidden;
      border-radius: var(--border-radius-md);
    }

    &__overlay {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.6);
      opacity: 0;
      transition: var(--transition-smooth);
    }

    &__image-wrapper:hover &__overlay {
      opacity: 1;
    }

    &__zoom-icon {
      font-size: 3rem;
      transform: scale(0.8);
      transition: var(--transition-smooth);
    }

    &__image-wrapper:hover &__zoom-icon {
      transform: scale(1);
    }

    &__image {
      width: 100%;
      height: auto;
      border-radius: 0.5rem;
      margin-bottom: 1rem;
      object-fit: cover;
    }

    &__title {
      font-size: 1.1rem;
      font-weight: bold;
      color: var(--text-color);
      margin-top: 0.5rem;
    }
  }

  /* Media queries para ajustar en pantallas peque√±as */
  @media (max-width: 768px) {
    .certificates {
      padding: 1rem;

      &__title {
        font-size: 1rem;
      }

      &__list {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
      }
    }
  }

  .section__title {
    font-size: 2rem;
    font-weight: bold;
    color: var(--accents-8);
    text-align: center;
    margin-bottom: 2rem;
  }

  /* Lightbox */
  .lightbox {
    position: fixed;
    inset: 0;
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.95);
    opacity: 0;
    pointer-events: none;
    transition: var(--transition-smooth);

    &.active {
      opacity: 1;
      pointer-events: all;
    }

    &__close {
      position: absolute;
      top: 1.5rem;
      right: 1.5rem;
      z-index: 10001;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 3rem;
      height: 3rem;
      font-size: 2.5rem;
      color: white;
      cursor: pointer;
      background: rgba(0, 0, 0, 0.5);
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      transition: var(--transition-smooth);

      &:hover {
        background: rgba(0, 0, 0, 0.8);
        transform: rotate(90deg) scale(1.1);
      }
    }

    &__content {
      max-width: 90vw;
      max-height: 90vh;
      padding: 1rem;
    }

    &__image {
      max-width: 100%;
      max-height: 90vh;
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-elevated);
      animation: zoomIn 0.4s ease-out;
    }
  }
</style>

<script>
  import { ParticleAnimation } from "../../utils/particles";

  document.addEventListener("DOMContentLoaded", () => {
    const canvas = document.querySelector(
      ".certificates [data-particle-animation]",
    );
    if (!(canvas instanceof HTMLCanvasElement)) return;

    const certificatesParticles = new ParticleAnimation(canvas, {
      quantity: 15,
      staticity: 2,
      ease: 30,
      particleColor: {
        light: "rgba(255, 0, 0, 0.6)",
        dark: "rgba(255, 255, 255, 0.6)",
      },
    });

    // Limpieza cuando el componente se desmonta
    document.addEventListener("astro:before-swap", () => {
      certificatesParticles.destroy();
    });

    // Lightbox functionality
    const lightbox = document.getElementById("certificate-lightbox");
    const lightboxImage = lightbox?.querySelector(
      ".lightbox__image",
    ) as HTMLImageElement;
    const lightboxClose = lightbox?.querySelector(".lightbox__close");
    const certificateButtons = document.querySelectorAll(
      "[data-certificate-index]",
    );

    const openLightbox = (imageSrc: string, imageAlt: string) => {
      if (!lightbox || !lightboxImage) return;

      lightboxImage.src = imageSrc;
      lightboxImage.alt = imageAlt;
      lightbox.classList.add("active");
      lightbox.setAttribute("aria-hidden", "false");
      document.body.style.overflow = "hidden";
    };

    const closeLightbox = () => {
      if (!lightbox) return;

      lightbox.classList.remove("active");
      lightbox.setAttribute("aria-hidden", "true");
      document.body.style.overflow = "";
    };

    // Event listeners para cada certificado
    certificateButtons.forEach((button) => {
      button.addEventListener("click", () => {
        const img = button.querySelector(
          ".certificates__image",
        ) as HTMLImageElement;
        if (img) {
          openLightbox(img.src, img.alt);
        }
      });
    });

    // Cerrar lightbox
    lightboxClose?.addEventListener("click", closeLightbox);
    lightbox?.addEventListener("click", (e) => {
      if (e.target === lightbox) {
        closeLightbox();
      }
    });

    // Cerrar con tecla Escape
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && lightbox?.classList.contains("active")) {
        closeLightbox();
      }
    });
  });
</script>
